
# –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø–∞–∫–µ—Ç–∞ –≤ iptables

–ü–∞–∫–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ `iptables`, –∏ –∫–∞–∂–¥–æ–µ –ø—Ä–∞–≤–∏–ª–æ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ. –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏ —Ü–µ–ø–æ—á–∫–∞–º–∏.

```mermaid
flowchart TD
    subgraph PREROUTING ["PREROUTING (mangle, nat)"]
        A[–í—Ö–æ–¥—è—â–∏–π –ø–∞–∫–µ—Ç]
    end

    subgraph Routing[–ü—Ä–æ—Ü–µ—Å—Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏]
        B[–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–∞–∫–µ—Ç–∞]
    end

    subgraph INPUT ["INPUT (mangle, filter)"]
        C[–ü–∞–∫–µ—Ç –∞–¥—Ä–µ—Å–æ–≤–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ]
    end
    
    subgraph FORWARD ["FORWARD (mangle, filter)"]
        D[–ü–∞–∫–µ—Ç –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É]
    end
    
    subgraph OUTPUT ["OUTPUT (mangle, nat, filter)"]
        E[–ò—Å—Ö–æ–¥—è—â–∏–π –ø–∞–∫–µ—Ç]
    end
    
    subgraph POSTROUTING ["POSTROUTING (mangle, nat)"]
        F[–ü–∞–∫–µ—Ç –ø–æ–∫–∏–¥–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É]
    end

    A -->|–ü–∞–∫–µ—Ç –ø–æ—Å—Ç—É–ø–∞–µ—Ç –≤ —Å–∏—Å—Ç–µ–º—É| PREROUTING
    PREROUTING -->|–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è| Routing
    Routing -->|–ï—Å–ª–∏ –ø–∞–∫–µ—Ç –∞–¥—Ä–µ—Å–æ–≤–∞–Ω —Å–∏—Å—Ç–µ–º–µ| INPUT
    Routing -->|–ï—Å–ª–∏ –ø–∞–∫–µ—Ç –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç—Å—è| FORWARD
    INPUT -->|–û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º| G[–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ]
    G --> OUTPUT
    OUTPUT -->|–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ| POSTROUTING
    FORWARD -->|–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø–µ—Ä–µ—Å—ã–ª–∫–∏| POSTROUTING
    POSTROUTING -->|–ü–∞–∫–µ—Ç –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ —Å–∏—Å—Ç–µ–º—ã| H[–ü–µ—Ä–µ–¥–∞—á–∞ –≤ —Å–µ—Ç—å]
```


# –ö–æ–Ω—Ü–µ–ø—Ü–∏—è
## –¶–µ–ø–æ—á–∫–∏
–≠—Ç–æ –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –ø–∞–∫–µ—Ç—ã –≤ `iptables`. –ü–∞–∫–µ—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ —Ü–µ–ø–æ—á–∫–∏, –∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª–∞, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –Ω–∞–π–¥–µ–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ.

|  **–¶–µ–ø–æ—á–∫–∏**    | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**                                       | **–û–ø–∏—Å–∞–Ω–∏–µ**                                                                                                                                         | **–ü—Ä–∏–º–µ—Ä**                                                                                                                                                                                |
|------------------|------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **INPUT**        | –ü–∞–∫–µ—Ç—ã, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.              | –¶–µ–ø–æ—á–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫. –≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–∞–∫–µ—Ç–æ–≤, –ø–æ—Å—Ç—É–ø–∞—é—â–∏—Ö –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.                                 | –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –Ω–∞ –ø–æ—Ä—Ç 80 (HTTP):<br>```sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT```                                                                         |
| **OUTPUT**       | –ü–∞–∫–µ—Ç—ã, –∏—Å—Ö–æ–¥—è—â–∏–µ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.                      | –¶–µ–ø–æ—á–∫–∞ –¥–ª—è –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–∞–∫–µ—Ç—ã, –∏—Å—Ö–æ–¥—è—â–∏–µ –∏–∑ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.                                                                          | –ó–∞–ø—Ä–µ—â–µ–Ω–∏–µ –∏—Å—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–∞ –ø–æ—Ä—Ç 25 (SMTP):<br>```sudo iptables -A OUTPUT -p tcp --dport 25 -j REJECT```                                                                            |
| **FORWARD**      | –ü–∞–∫–µ—Ç—ã, –ø—Ä–æ—Ö–æ–¥—è—â–∏–µ —á–µ—Ä–µ–∑ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä). |–¶–µ–ø–æ—á–∫–∞ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ –º–µ–∂–¥—É —Å–µ—Ç–µ–≤—ã–º–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏. –û–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—ã.                     | –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ IP, –ø—Ä–æ—Ö–æ–¥—è—â–µ–≥–æ —á–µ—Ä–µ–∑ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä:<br>```sudo iptables -A FORWARD -p tcp -s 192.168.1.100 -j ACCEPT```                                                 |
| **PREROUTING**   | –î–µ–π—Å—Ç–≤–∏—è –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏                                | –¶–µ–ø–æ—á–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–∞–∫–µ—Ç—ã –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–∏ –ø–æ–ø–∞–¥—É—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è NAT).                                   | –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π IP-–∞–¥—Ä–µ—Å:<br>```sudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination 192.168.1.100:8080```                               |
| **POSTROUTING**  | –î–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏                             | –¶–µ–ø–æ—á–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–∞–∫–µ—Ç—ã –ø–æ—Å–ª–µ –∏—Ö –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∏—Å—Ö–æ–¥—è—â–∏—Ö –ø–∞–∫–µ—Ç–∞—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä, NAT).                              | –ú–∞—Å–∫–∞—Ä–∞–¥–∏–Ω–≥ –¥–ª—è –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–µ):<br>```sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE```                                                          |

## –¢–∞–±–ª–∏—Ü—ã

–°–∏—Å—Ç–µ–º–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø—Ä–∞–≤–∏–ª –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞. –í `iptables` –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü, –∫–∞–∂–¥–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –∏–º–µ–µ—Ç —Å–≤–æ—é —Ü–µ–ª—å.

| **–¢–∞–±–ª–∏—Ü—ã**      | **–¶–µ–ø–æ—á–∫–∏**                                                                     | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**                              | **–û–ø–∏—Å–∞–Ω–∏–µ**                                                                                                                                              | **–ü—Ä–∏–º–µ—Ä**                                                                                                                         |
|------------------|---------------------------------------------------------------------------------|---------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------|
| **filter**       | **INPUT**<br/>**OUTPUT**<br/>**FORWARD**                                        | –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.                | –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–∞–∫–µ—Ç–æ–≤. –í—Å–µ —Ü–µ–ø–æ—á–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü–µ.                                                               | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–∞–∫–µ—Ç–æ–≤: <br>```sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT```                                                   |
| **nat**          | **PREROUTING**<br/>**OUTPUT**<br/>**POSTROUTING**                               | –î–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤.                 | –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º –∞–¥—Ä–µ—Å–æ–≤ (NAT), –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π —Å IP-–∞–¥—Ä–µ—Å–∞–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ä—Ç–æ–≤.             | –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤: <br>```sudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination 192.168.1.100:8080``` |
| **mangle**       | **PREROUTING**<br/>**INPUT**<br/>**OUTPUT**<br/>**FORWARD**<br/>**POSTROUTING** | –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤.                      | –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è TOS (Type of Service), TTL (Time to Live) –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.                                   | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—è TTL –≤ –ø–∞–∫–µ—Ç–∞—Ö:<br>```sudo iptables -t mangle -A POSTROUTING -j TTL --ttl-set 64```                                  |
| **raw**          | **PREROUTING**<br/>**OUTPUT**                                                   | –î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏.  | –¢–∞–±–ª–∏—Ü–∞, –∫–æ—Ç–æ—Ä–∞—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–∞–∫–µ—Ç—ã –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–∏ –ø–æ–ø–∞–¥—É—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç NAT. | –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö):<br>```sudo iptables -t raw -A PREROUTING -j NOTRACK```  |

## –î–µ–π—Å—Ç–≤–∏—è (-j)

–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –¥–ª—è –ø–∞–∫–µ—Ç–∞, –µ—Å–ª–∏ –æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É –ø—Ä–∞–≤–∏–ª—É. –ü—Ä–∏–º–µ—Ä: —Ä–∞–∑—Ä–µ—à–∏—Ç—å, –æ—Ç–∫–ª–æ–Ω–∏—Ç—å, –∑–∞–ø–∏—Å–∞—Ç—å –ª–æ–≥ –∏ —Ç.–¥.

| **–¶–µ–ª–∏ (targets)** | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**                                                             | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞.                                                                                                                                 | **–ü—Ä–∏–º–µ—Ä**                                                                                             | 
|--------------------|----------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| **ACCEPT**         | –†–∞–∑—Ä–µ—à–∏—Ç—å –ø–∞–∫–µ—Ç.                                                           | –†–∞–∑—Ä–µ—à–∞–µ—Ç –ø–µ—Ä–µ–¥–∞—á—É –ø–∞–∫–µ—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö –¥–ª—è —è–≤–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞.                                                                   | ```sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT```                                               |
| **DROP**           | –û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø–∞–∫–µ—Ç.                                                           | –û—Ç–∫–ª–æ–Ω—è–µ—Ç –ø–∞–∫–µ—Ç –±–µ–∑ –æ—Ç–≤–µ—Ç–∞. –≠—Ç–æ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–± –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, —Ç–∞–∫ –∫–∞–∫ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –ø–∞–∫–µ—Ç–µ.      | ```sudo iptables -A INPUT -p tcp --dport 80 -j DROP```                                                 |
| **REJECT**         | –û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø–∞–∫–µ—Ç —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ.                           | –û—Ç–∫–ª–æ–Ω—è–µ—Ç –ø–∞–∫–µ—Ç, –Ω–æ –ø–æ—Å—ã–ª–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ. –û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—Ç–∫–∞–∑–µ.         | ```sudo iptables -A INPUT -p tcp --dport 80 -j REJECT```                                               |
| **LOG**            | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞.                                                        | –õ–æ–≥–∏—Ä—É–µ—Ç –ø–∞–∫–µ—Ç, –∑–∞–ø–∏—Å—ã–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω—ë–º –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∂—É—Ä–Ω–∞–ª. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏–ª–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.                                        | ```sudo iptables -A INPUT -p tcp --dport 80 -j LOG --log-prefix "HTTP_REQUEST: "```                    |
| **MASQUERADE**     | –ü–æ–¥–º–µ–Ω–∏—Ç—å ip –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π (–Ω–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–Ω–µ—à–Ω–µ–≥–æ ip).     | –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ NAT –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ IP-–∞–¥—Ä–µ—Å–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≤—ã—Ö–æ–¥–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ —á–µ—Ä–µ–∑ –æ–¥–∏–Ω –≤–Ω–µ—à–Ω–∏–π IP-–∞–¥—Ä–µ—Å. | ```sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE```                                        |
| **SNAT**           | –ü–æ–¥–º–µ–Ω–∏—Ç—å ip –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –Ω–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–Ω–µ—à–Ω–∏–π ip.                          | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –ø–∞–∫–µ—Ç–∞ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π.                        | ```sudo iptables -t nat -A POSTROUTING -s 192.168.1.100 -j SNAT --to 192.168.1.1```                    |
| **DNAT**           | –ü–æ–¥–º–µ–Ω–∏—Ç—å ip:port –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –∑–∞–¥–∞–Ω–Ω—ã–π. (—á–∞—Å—Ç–Ω—ã–π —Å–ª—É—á–∞–π –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤). | –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–∞–∫–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä).                                               | ```sudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination 192.168.1.100:8080``` |

## –°–≤—è–∑–∏ —Ü–µ–ø–æ—á–µ–∫, —Ç–∞–±–ª–∏—Ü –∏ –¥–µ–π—Å—Ç–≤–∏–π –≤ iptables

| **–î–µ–π—Å—Ç–≤–∏—è (-j)**  | **–¢–∞–±–ª–∏—Ü–∞ (Table)**    | **–¶–µ–ø–æ—á–∫–∞ (Chain)**         | **–û–ø–∏—Å–∞–Ω–∏–µ**                               |
|--------------------|------------------------|-----------------------------|--------------------------------------------|
| **ACCEPT**         | filter                 | INPUT, FORWARD, OUTPUT      | –†–∞–∑—Ä–µ—à–∞–µ—Ç –ø–∞–∫–µ—Ç                            |
| **DROP**           | filter                 | INPUT, FORWARD, OUTPUT      | –û—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–∞–∫–µ—Ç                          |
| **REJECT**         | filter                 | INPUT, FORWARD, OUTPUT      | –û—Ç–∫–ª–æ–Ω—è–µ—Ç –ø–∞–∫–µ—Ç —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º             |
| **LOG**            | filter, nat, mangle    | –õ—é–±–∞—è                       | –õ–æ–≥–∏—Ä—É–µ—Ç –ø–∞–∫–µ—Ç –≤ syslog                    |
| **SNAT**           | nat                    | POSTROUTING                 | –ú–µ–Ω—è–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–∞–∫–µ—Ç–∞ (Source NAT)        |
| **DNAT**           | nat                    | PREROUTING, OUTPUT          | –ú–µ–Ω—è–µ—Ç –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (Destination NAT)  |
| **MASQUERADE**     | nat                    | POSTROUTING                 | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SNAT                          |
| **REDIRECT**       | nat                    | PREROUTING, OUTPUT          | –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É  |
| **MARK**           | mangle                 | PREROUTING, OUTPUT, FORWARD | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–µ—Ç–∫—É –ø–∞–∫–µ—Ç–∞                 |
| **TTL**            | mangle                 | PREROUTING, OUTPUT, FORWARD | –ú–µ–Ω—è–µ—Ç TTL –ø–∞–∫–µ—Ç–∞                          |
| **TOS**            | mangle                 | PREROUTING, OUTPUT, FORWARD | –ú–µ–Ω—è–µ—Ç TOS (Type of Service)               |
| **NOTRACK**        | raw                    | PREROUTING, OUTPUT          | –û—Ç–∫–ª—é—á–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π          |
| **CONNMARK**       | mangle                 | PREROUTING, OUTPUT, FORWARD | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–µ—Ç–∫—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è             |
| **QUEUE**          | filter, nat, mangle    | –õ—é–±–∞—è                       | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞–∫–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è    |
| **RETURN**         | –õ—é–±–∞—è                  | –õ—é–±–∞—è                       | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Ü–µ–ø–æ—á–∫—É |

## üîπ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (Commands)
| –ö–ª—é—á | –û–ø–∏—Å–∞–Ω–∏–µ                                                 |
|------|----------------------------------------------------------|
| `-A` | –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ –≤ –∫–æ–Ω–µ—Ü —Ü–µ–ø–æ—á–∫–∏ (`-A INPUT`)            |
| `-I` | –í—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ –≤ –Ω–∞—á–∞–ª–æ (–∏–ª–∏ –ø–æ –Ω–æ–º–µ—Ä—É) (`-I INPUT 2`) |
| `-D` | –£–¥–∞–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é (`-D INPUT 3`)  |
| `-R` | –ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ (`-R INPUT 1 -s 192.168.1.1 -j DROP`)   |
| `-L` | –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ (`-L -n -v` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞)  |
| `-F` | –û—á–∏—Å—Ç–∏—Ç—å —Ü–µ–ø–æ—á–∫—É (`-F INPUT`)                            |
| `-Z` | –°–±—Ä–æ—Å–∏—Ç—å —Å—á—ë—Ç—á–∏–∫–∏ –ø–∞–∫–µ—Ç–æ–≤/–±–∞–π—Ç (`-Z INPUT`)              |
| `-N` | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Ü–µ–ø–æ—á–∫—É (`-N MY_CHAIN`)   |
| `-X` | –£–¥–∞–ª–∏—Ç—å –ø—É—Å—Ç—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Ü–µ–ø–æ—á–∫—É (`-X MY_CHAIN`)  |
| `-P` | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`-P INPUT DROP`)       |

## üîπ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∞–≤–∏–ª (Rule Specifications)
| –ö–ª—é—á      | –û–ø–∏—Å–∞–Ω–∏–µ                                                         |
|-----------|------------------------------------------------------------------|
| `-p`      | –ü—Ä–æ—Ç–æ–∫–æ–ª (`tcp`, `udp`, `icmp`, `all`)                           |
| `-s`      | –ò—Å—Ö–æ–¥–Ω—ã–π IP/–ø–æ–¥—Å–µ—Ç—å (`-s 192.168.1.0/24`)                        |
| `-d`      | –¶–µ–ª–µ–≤–æ–π IP/–ø–æ–¥—Å–µ—Ç—å (`-d 10.0.0.1`)                               |
| `-i`      | –í—Ö–æ–¥—è—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (`-i eth0`)                                   |
| `-o`      | –ò—Å—Ö–æ–¥—è—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (`-o eth1`)                                  |
| `-j`      | –î–µ–π—Å—Ç–≤–∏–µ (`ACCEPT`, `DROP`, `REJECT`, `LOG`, `DNAT`, `SNAT` ...) |
| `--sport` | –ò—Å—Ö–æ–¥–Ω—ã–π –ø–æ—Ä—Ç (`--sport 22`)                                     |
| `--dport` | –¶–µ–ª–µ–≤–æ–π –ø–æ—Ä—Ç (`--dport 80`)                                      |
| `-m`      | –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥—É–ª—å (`-m state --state ESTABLISHED`)                |

## üîπ –ú–æ–¥—É–ª–∏ (Match Extensions)
| –ú–æ–¥—É–ª—å      | –û–ø–∏—Å–∞–Ω–∏–µ                                                                | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è                                   |
|-------------|-------------------------------------------------------------------------|--------------------------------------------------------|
| `state`     | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (NEW, ESTABLISHED, RELATED, INVALID) | `-m state --state ESTABLISHED,RELATED`                 |
| `conntrack` | –ê–Ω–∞–ª–æ–≥ `state`, –Ω–æ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π | `-m conntrack --ctstate INVALID -j DROP`               |
| `limit`     | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª                                 | `-m limit --limit 5/sec --limit-burst 10`              |
| `multiport` | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ—Ä—Ç–∞–º                                         | `-m multiport --ports 22,80,443`                       |
| `iprange`   | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É IP-–∞–¥—Ä–µ—Å–æ–≤                                      | `-m iprange --src-range 192.168.1.1-192.168.1.100`     |
| `string`    | –ü–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫ –≤ –ø–∞–∫–µ—Ç–∞—Ö (–¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É)                   | `-m string --string "blockme" --algo bm`               |
| `time`      | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–¥–Ω–∏/—á–∞—Å—ã)                                        | `-m time --timestart 09:00 --timestop 18:00`           |
| `connlimit` | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –æ–¥–Ω–æ–≥–æ IP                           | `-m connlimit --connlimit-above 50 -j DROP`            |
| `hashlimit` | –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è `limit` —Å —É—á—ë—Ç–æ–º IP/–ø–æ—Ä—Ç–æ–≤                            | `-m hashlimit --hashlimit 10/sec --hashlimit-burst 20` |
| `mac`       | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ MAC-–∞–¥—Ä–µ—Å—É                                                | `-m mac --mac-source 00:1A:2B:3C:4D:5E`                |
| `owner`     | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ UID/GID –ø—Ä–æ—Ü–µ—Å—Å–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è OUTPUT)                      | `-m owner --uid-owner 1000`                            |
| `tos`       | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É —Å–µ—Ä–≤–∏—Å–∞ (Type of Service)                            | `-m tos --tos Minimize-Delay`                          |
| `length`    | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–ª–∏–Ω–µ –ø–∞–∫–µ—Ç–∞                                              | `-m length --length 100:200`                           |
| `recent`    | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ IP –≤ —á—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫                              | `-m recent --name ATTACKERS --set`                     |
| `set`       | –†–∞–±–æ—Ç–∞ —Å IP/–ø–æ—Ä—Ç-–Ω–∞–±–æ—Ä–∞–º–∏ (ipset)                                       | `-m set --match-set blacklist src`                     |
| `geoip`     | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–µ (—Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏)                      | `-m geoip --src-cc RU,CN`                              |
| `comment`   | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ –ø—Ä–∞–≤–∏–ª—É                                        | `-m comment --comment "Block SSH brute-force"`         |

## –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (--state)

| –°–æ—Å—Ç–æ—è–Ω–∏–µ   | 	–û–ø–∏—Å–∞–Ω–∏–µ                                                              | 	–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è                   |
|-------------|------------------------------------------------------------------------|-----------------------------------------|
| NEW         | 	–ù–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–ø–µ—Ä–≤—ã–π –ø–∞–∫–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, SYN –≤ TCP).                 | 	-m state --state NEW -j ACCEPT         |
| ESTABLISHED | 	–£–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–ø–∞–∫–µ—Ç—ã –≤ —Ä–∞–º–∫–∞—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–µ—Å—Å–∏–∏).   | 	-m state --state ESTABLISHED -j ACCEPT |
| RELATED     | 	–°–≤—è–∑–∞–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, FTP-–ø–∞—Å—Å–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –∏–ª–∏ ICMP-–æ—à–∏–±–∫–∏). | 	-m state --state RELATED -j ACCEPT     |
| INVALID     | 	–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –ø–∞–∫–µ—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –±–∏—Ç—ã–º –∑–∞–≥–æ–ª–æ–≤–∫–æ–º).                     | 	-m state --state INVALID -j DROP       |
#### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã.
```shell
# 1. –†–∞–∑—Ä–µ—à–∞–µ–º NEW —Ç–æ–ª—å–∫–æ –¥–ª—è SSH (–ø–æ—Ä—Ç 22)
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
# 2. –†–∞–∑—Ä–µ—à–∞–µ–º –æ—Ç–≤–µ—Ç—ã –Ω–∞ –õ–Æ–ë–´–ï –∑–∞–ø—Ä–æ—Å—ã —Å–µ—Ä–≤–µ—Ä–∞ (ESTABLISHED/RELATED)
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
# 3. –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –±–ª–æ–∫–∏—Ä—É–µ–º
iptables -P INPUT DROP
```


# –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
## –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –∫—Ä–æ–º–µ –∑–∞–¥–∞–Ω–Ω—ã—Ö
```shell
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (DROP –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö)
iptables -P INPUT DROP
# –†–∞–∑—Ä–µ—à–∏—Ç—å SSH (22 –ø–æ—Ä—Ç)
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
# –†–∞–∑—Ä–µ—à–∏—Ç—å HTTP (80) –∏ HTTPS (443)
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT
# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
iptables -A INPUT -p tcp --dport 3306 -s 127.0.0.1 -j ACCEPT
# –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ
iptables -A INPUT -p tcp --dport 3306 -j DROP
# –†–∞–∑—Ä–µ—à–∏—Ç—å –æ—Ç–≤–µ—Ç—ã –Ω–∞ –∏—Å—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã (ESTABLISHED)
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
```
## –ó–∞–ø—Ä–µ—Ç –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
```shell
# –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ HTTP/HTTPS –¥–ª—è IP 192.168.1.100
iptables -A OUTPUT -d 192.168.1.100 -p tcp --dport 80 -j DROP
iptables -A OUTPUT -d 192.168.1.100 -p tcp --dport 443 -j DROP
# –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ—á—Ç—ã (SMTP)
iptables -A OUTPUT -p tcp --dport 25 -j DROP
```
## –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ ICMP (ping)
```shell
# –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –≤—Ö–æ–¥—è—â–∏–µ ping-–∑–∞–ø—Ä–æ—Å—ã
iptables -A INPUT -p icmp --icmp-type echo-request -j DROP
```
## –ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ (Port Forwarding)
```shell
# –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Ä—Ç 8080 –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–µ—Ä–≤–µ—Ä 192.168.1.10:80
iptables -t nat -A PREROUTING -p tcp --dport 8080 -j DNAT --to-destination 192.168.1.10:80
iptables -A FORWARD -p tcp -d 192.168.1.10 --dport 80 -j ACCEPT
```
## NAT –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ (—Ä–∞–∑–¥–∞—á–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)
```shell
# –í–∫–ª—é—á–∏—Ç—å —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥
echo 1 > /proc/sys/net/ipv4/ip_forward
# –†–∞–∑—Ä–µ—à–∏—Ç—å MASQUERADE (NAT)
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥ –º–µ–∂–¥—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏
iptables -A FORWARD -i eth1 -o eth0 -j ACCEPT
iptables -A FORWARD -i eth0 -o eth1 -m state --state ESTABLISHED,RELATED -j ACCEPT
```
## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤
```shell
# –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –ø–æ—Ä—Ç 80
iptables -A INPUT -p tcp --dport 80 -m limit --limit 5/min -j LOG --log-prefix "HTTP Traffic: "

```

















