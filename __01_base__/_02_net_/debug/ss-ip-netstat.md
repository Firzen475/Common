
## Важно
1. Маршруты, добавленные через ip route, сбрасываются после перезагрузки.
2. Для постоянного сохранения маршрутов настройте их в:
   * /etc/network/interfaces (Debian/Ubuntu)
   * /etc/sysconfig/network-scripts/route-<интерфейс> (RHEL/CentOS)
   * Через NetworkManager (nmcli).

## Сравнение
| **Действие**                | **netstat**                          | **ss**                              |
|-----------------------------|--------------------------------------|-------------------------------------|
| Все TCP-соединения          | `netstat -t`                         | `ss -t`                             |
| Все UDP-соединения          | `netstat -u`                         | `ss -u`                             |
| Слушающие порты             | `netstat -l`                         | `ss -l`                             |
| Показать PID/имя процесса   | `netstat -p` (требует `sudo`)        | `ss -p` (требует `sudo`)            |
| Только IPv4                 | `netstat -4`                         | `ss -4`                             |
| Только IPv6                 | `netstat -6`                         | `ss -6`                             |
| Фильтр по состоянию         | `netstat -t \| grep ESTABLISHED`     | `ss -t state established`           |
| Показать таблицу маршрутов  | `netstat -r`                         | `ip route` (не `ss`, но из `iproute2`)|

## Состояния
### State
| Состояние       | Описание                                                                 |
|----------------|--------------------------------------------------------------------------|
| **ESTABLISHED** | Соединение установлено и активно                                         |
| **SYN-SENT**    | Клиент отправил SYN, ожидает ответа (начало установки соединения)        |
| **SYN-RECV**    | Сервер получил SYN, отправил SYN-ACK (ожидает подтверждения)             |
| **FIN-WAIT-1**  | Первая стадия завершения соединения (сторона отправила FIN)              |
| **FIN-WAIT-2**  | Ожидание подтверждения FIN от другой стороны                             |
| **TIME-WAIT**   | Ожидание перед закрытием для гарантированного завершения                 |
| **CLOSED**      | Соединение полностью закрыто (редко отображается)                        |
| **CLOSE-WAIT**  | Ожидание локального закрытия после получения FIN                         |
| **LAST-ACK**    | Ожидание подтверждения последнего FIN                                    |
| **LISTEN**      | Сокет ожидает входящих соединений (серверный режим)                     |
| **CLOSING**     | Редкое состояние - обе стороны попытались закрыться одновременно        |
| **UNKNOWN**     | Неизвестное состояние (обычно ошибка)                                   |

### State
| Тип (Type)   | Описание                                                                 | Протоколы/Примеры                          | Флаг для фильтрации       |
|--------------|--------------------------------------------------------------------------|--------------------------------------------|--------------------------|
| **STREAM**   | Надёжные двусторонние соединения с установкой подключения                | TCP, Unix-сокеты (SOCK_STREAM)             | `netstat -t`             |
| **DGRAM**    | Датаграммные соединения без установки подключения                       | UDP, Unix-сокеты (SOCK_DGRAM)              | `netstat -u`             |
| **RAW**      | Низкоуровневый доступ к IP-пакетам (включая заголовки)                  | ICMP, кастомные протоколы                  | `netstat --protocol=raw` |
| **SEQPACKET**| Надёжные пакетные соединения с сохранением границ сообщений             | SCTP, Unix-сокеты (SOCK_SEQPACKET)         | `netstat --protocol=sctp`|
| **RDM**      | Надёжные датаграммы (сохраняет порядок сообщений, но редко используется) | Экзотические протоколы                     | -                        |

## Использование
```shell
# ip цифрами | tcp | udp | all | pid 
ss -ntuap
# диапазон
ss -ntuap sport ge 6000 and sport le 7000

ip route show
ip route show cache
# добавление
sudo ip route add 192.168.2.0/24 via 192.168.1.1 dev eth0 # подсеть на шлюз 1.1
ip route add 172.16.0.0/16 dev tun0 # отправка подсети в тоннель
# удаление
sudo ip route flush 10.0.0.0/8



```