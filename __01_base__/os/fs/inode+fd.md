# inode
* uid файла, существует пока есть хотя-бы одна жесткая ссылка.
* Находится в таблице inode в группах блоков файловой системы.
* Количество зависит от fs и форматирования.
* Содержит: тип, размер, права, владельца, время, кол-во жестких ссылок, указатели на блоки.
* Может удерживаться процессом после удаления всех жестких ссылок.
#### Просмотр
```shell
df -i
ls -i
stat file
```
# file descriptors
* Доступ процесса к файлам, сокетам, каналам и другим ресурсам ввода-вывода.
* Ограничено настройками системы 
  * Может быть изменено для процесса или пользователя.
#### Просмотр
```shell
# fd процесса
lsof -p PID || ls -al /proc/PID/fd/
# Список удерживаемых файлов
lsof | grep deleted
```
# Полезное
#### Восстановление данных открытого, но удалённого файла
```shell
cat /proc/1234/fd/5 > /tmp/recovered_file.log
```
#### Удаление содержимого открытого файла
```shell
truncate /tmp/recovered_file.log
```











# lsof
Утилита `lsof` (от LiSt Open Files) используется для отображения информации о файлах, которые в данный момент открыты в операционной системе. Она предоставляет список всех открытых файлов и процессов, которые их используют. Это может быть полезно для диагностики, мониторинга, а также для решения проблем с доступом к файлам.
## Вывод команды lsof:
```bash
COMMAND    PID    USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
bash      1234   user   cwd    DIR  8,1    4096  1234 /home/user
bash      1234   user   1w     REG  8,1   1024    5678 /home/user/file.txt
```
* `COMMAND`: Имя процесса.
* `PID`: Идентификатор процесса.
* `USER`: Пользователь, запустивший процесс.
* `FD`: Файл или дескриптор файла (например, cwd — текущая рабочая директория, 1w — стандартный вывод, открытый для записи).
* `TYPE`: Тип файла (например, DIR — каталог, REG — обычный файл).
* `DEVICE`: Устройство, на котором находится файл.
* `SIZE/OFF`: Размер файла или смещение в байтах.
* `NODE`: Номер узла файла.
* `NAME`: Путь к файлу.

| Ключ      | Описание                                                                                       | Пример использования                                                                     |
|-----------|------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|
| `-a`      | Указывает, что выводить только те результаты, которые соответствуют всем указанным условиям.   | `lsof -i -u username` — покажет открытые сетевые соединения для пользователя `username`. |
| `-c`      | Фильтрует результаты по имени команды (процесса).                                              | `lsof -c bash` — покажет файлы, открытые процессами с именем `bash`.                     |
| `-d`      | Фильтрует по дескриптору файла (например, стандартный ввод, вывод или ошибка).                 | `lsof -d 1` — покажет файлы, открытые для стандартного вывода.                           |
| `-i`      | Показывает информацию о сетевых соединениях (сокетах), используя фильтры.                      | `lsof -i :80` — покажет все процессы, использующие порт 80.                              |
| `-n`      | Отключает преобразование IP-адресов в доменные имена (выводит IP-адреса вместо доменных имен). | `lsof -i -n` — покажет сетевые соединения с IP-адресами, а не доменными именами.         |
| `-p`      | Фильтрует по идентификатору процесса (PID).                                                    | `lsof -p 1234` — покажет файлы, открытые процессом с PID 1234.                           |
| `-u`      | Фильтрует по пользователю, чьи файлы открыты.                                                  | `lsof -u username` — покажет файлы, открытые процессами пользователя `username`.         |
| `+D`      | Показывает файлы, открытые в указанной директории (рекурсивно).                                | `lsof +D /var/log` — покажет все открытые файлы в директории `/var/log`.                 |
| `+L`      | Показывает файлы с символическими ссылками, и какие файлы они ссылаются.                       | `lsof +L1` — покажет файлы, которые являются символическими ссылками.                    |
| `-r`      | Повторяет вывод с указанным интервалом времени (в секундах).                                   | `lsof -r 5` — будет обновлять вывод каждые 5 секунд.                                     |
| `-t`      | Выводит только идентификаторы процессов (PID).                                                 | `lsof -t` — выведет только PID всех процессов, которые открыли файлы.                    |
| `-v`      | Показывает дополнительную информацию о версии утилиты.                                         | `lsof -v` — покажет информацию о версии утилиты `lsof`.                                  |
| `-F`      | Указывает, что выводить данные в формате, удобном для дальнейшей обработки (например, CSV).    | `lsof -F p` — выведет только PID каждого процесса, который открыл файл.                  |
| `-h`      | Показывает справку (помощь) по использованию утилиты.                                          | `lsof -h` — выведет справочную информацию о ключах и синтаксисе.                         |

# strace
### Куда пишет процесс
```bash
strace -e write -s 9999 -p 12345
# 1 это файловый дескриптор stdout
write(1, "\320\237\321\200\320\270\320\262\320\265\321\202, \321\215\321\202\320\276 \321\202\320\265\321\201\321\202\320\276\320\262\320\276\320\265 \321\201\320\276\320\276\320\261\321\211\320\265\320\275\320\270\320\265!\n", 58) = 58
```











